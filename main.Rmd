# install required packages/library
```{r}
install.packages("matlib")
install.packages("rsample")
```

# import required packages/library
```{r}
library(matlib)
library(ggplot2)
library(rsample)
library(corrplot)
```

# load features dataset
```{r}
features<-as.matrix(read.csv(file="data/features.csv",header=F))
colnames(features)<-c("x1", "x3", "x4", "x5")
head(features)
```

# load target dataset
```{r}
target<-as.matrix(read.csv(file="data/target.csv",header=F))
colnames(target)<-c("X2")
head(target)
```

# load time series dataset
```{r}
time<-as.matrix((read.csv(file="data/timeseries.csv",header=F)))
colnames(time)<-c("T1")
head(time)
```

# Task 1: Preliminary Data Analysis
# time series of input signals
```{r}
features.ts<-ts(features,start=c(min(time),max(time)),frequency=1)
plot(features.ts,main="Time Series - Input Signal",xlab="Time",ylab="Input Signal")
```

# time series of output signal
```{r}
target.ts<-ts(target,start=c(min(time),max(time)),frequency=1)
plot(target.ts,main="Time Series - Output Signal",xlab="Time",ylab="Output Signal")
```

# Task 1.2: Distribution of Each Signal
```{r}
# histogram for temperature (x1)
density_x1<-density(features[,"x1"])
hist(features[,"x1"],freq=FALSE, main="Distribution of Temperature (x1)", xlab="Ambient temperature (°C)")
lines(density_x1, lwd=2)
```

```{r}
# histogram for ambient pressure (x3)
density_x3<-density(features[,"x3"])
hist(features[,"x3"],freq=FALSE, main="Distribution of Ambient Pressure (x3)", xlab="Atmospheric pressure (millibar)")
lines(density_x3, lwd=2)
```

```{r}
# histogram for relative humidity (x4)
density_x4<-density(features[,"x4"])
hist(features[,"x4"],freq=FALSE, main="Distribution of Relative Humidity (x4)", xlab="Humidity level (%)")
lines(density_x4, lwd=2)
```

```{r}
# histogram for exhaust vacuum (x5)
density_x5<-density(features[,"x5"])
hist(features[,"x5"],freq=FALSE, main="Distribution of Exhaust Vacuum (x5)", xlab="Vacuum collected from the steam turbine (cm Hg)")
lines(density_x5, lwd=2)
```

```{r}
# histogram for net hourly electrical energy output (X2)
density_x2<-density(target[,"X2"])
hist(target[,"X2"],freq=FALSE, main="Distribution of Net hourly electrical energy output (X2)", xlab="Net hourly electrical energy output in MW")
lines(density_x2, lwd=2)
```

# Task 1.3: Correlation and Scatter Plots
```{r}
# correlation
combined <- cbind(features, target)
correlation<-cor(combined)
print(correlation)
corrplot(correlation)
```

# scatter plot of x1 and X2
```{r}
plot(features[,"x1"], 
     target[,"X2"], 
     main="Temperature vs Net Hourly Electrical Energy Output", 
     xlab="Temperature (°C)", 
     ylab="Net Hourly Electrical Energy Output (MW)")
```

# scatter plot of x3 and X2
```{r}
plot(features[,"x3"], 
     target[,"X2"], 
     main="Ambient Pressure vs Net Hourly Electrical Energy Output", 
     xlab="Ambient Pressure (millibar)", 
     ylab="Net Hourly Electrical Energy Output (MW)")
```

# scatter plot of x4 and X2
```{r}
plot(features[,"x4"], 
     target[,"X2"], 
     main="Relative Humidity vs Net Hourly Electrical Energy Output", 
     xlab="Relative Humidity (%)", 
     ylab="Net Hourly Electrical Energy Output (MW)")
```

# scatter plot of x5 and X2
```{r}
plot(features[,"x5"], 
     target[,"X2"], 
     main="Exhaust Vacuum vs Net Hourly Electrical Energy Output", 
     xlab="Exhaust Vacuum (cm Hg)", 
     ylab="Net Hourly Electrical Energy Output (MW)")
```

# Task 2: Regression - Modelling the Between the Gene Expression
```{r}
# candidate nonlinear polynomial regression models
model1<-function(X, theta){
  theta[1]*X$x4 + theta[2]*X$x3^2 + theta[3]
}

model2<-function(X, theta){
  theta[1]*X$x4 + theta[2]*X$x3^2 + theta[3]*X$x5 + theta[4]
}

model3<-function(X, theta){
  theta[1]*X$x3 + theta[2]*X$x4 + theta[3]*X$x5^3
}

model4<-function(X, theta){
  theta[1]*X$x4 + theta[2]*X$x3^2 + theta[3]*X$x5^3 + theta[4]
}

model5<-function(X, theta){
  theta[1]*X$x4 + theta[2]*X$x1^2 + theta[3]*X$x3^2 + theta[4]
}
```

# Task 2.1: estimation of model parameters (theta) for every candidate model using least square
```{r}
# convert matrix into dataframe
X<-as.data.frame(features)

theta_ridge<-function(X, y, lambda=1e-1){
  X_bias<-cbind(1, as.matrix(X))
  XtX <- t(X_bias) %*% X_bias  # compute X^T * X
  XtX_reg <- XtX + lambda * diag(c(0, rep(1, ncol(X)))) # regularization term 
  theta <- ginv(XtX_reg) %*% t(X_bias) %*% y # generalized inverse to solve
  return(theta)
}
```

```{r}
# theta for model 1
X_model1 <- data.frame(x4 = X$x4, x3 = X$x3^2)
theta_model1 <- theta_ridge(X_model1, target)
print("Theta Model 1:")
print(theta_model1)
```

```{r}
# theta for model 2
X_model2 <- data.frame(x4 = X$x4, x3 = X$x3^2, x5 = X$x5)
theta_model2 <- theta_ridge(X_model2, target)
print("Theta Model 2:")
print(theta_model2)
```

```{r}
X_model3 <- data.frame(x3 = X$x3, x4 = X$x4, x5 = X$x5^3)  
theta_model3 <- theta_ridge(X_model3, target)
print("Theta for Model 3:")
print(theta_model3)

```

```{r}
X_model4 <- data.frame(x4 = X$x4, x3 = X$x3^2, x5 = X$x5^3) 
theta_model4 <- theta_ridge(X_model4, target)
print("Theta for Model 4:")
print(theta_model4)
```

```{r}
X_model5 <- data.frame(x4 = X$x4, x1 = X$x1^2, x3 = X$x3^2)
theta_model5 <- theta_ridge(X_model5, Y)
print("Theta for Model 5:")
print(theta_model5)
```

# Task 2.2: Model Residual Sum of Squared Error (RSS)
```{r}
compute_rss<-function(X,y,theta,model){
  y_pred<-model(X, theta) # prediction
  rss<-sum((y-y_pred)^2)
  return(rss)
}
```

```{r}
# RSS for model1
rss_model1 <- compute_rss(X_model1, target, theta_model1, model1)
print("Model 1 RSS:")
print(rss_model1)
```

```{r}
rss_model2<-compute_rss(X_model2, target, theta_model2, model2)
print("Model 2 RSS:")
print(rss_model2)
```

```{r}
rss_model3<-compute_rss(X_model3, target, theta_model3, model3)
print("Model 3 RSS:")
print(rss_model3)
```

```{r}
rss_model4<-compute_rss(X_model4, target, theta_model4, model4)
print("Model 4 RSS:")
print(rss_model4)
```

```{r}
rss_model5<-compute_rss(X_model5,target,theta_model5,model5)
print("Model 5 RSS:")
print(rss_model5)
```

# Log-likelihood function
```{r}
compute_loglikelihood_variance<-function(rss, n){
  sigma_squared <- rss/(n-1)
  log_likelihood<- -(n/2)*log(2*pi)-(n/2)*log(sigma_squared)-(1/(2*sigma_squared))*rss
  return(list(log_likelihood=log_likelihood,variance=sigma_squared))
}
```

```{r}
# log likelihood model1
compute_model1<-compute_loglikelihood_variance(rss_model1, length(target))
model1_log_likelihood<-compute_model1$log_likelihood
model1_variance<-compute_model1$variance
print("Model 1 Log-Likelihood:")
print(model1_log_likelihood)
print("Model 1 variance:")
print(model1_variance)
```

